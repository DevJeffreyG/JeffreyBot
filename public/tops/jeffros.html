<!DOCTYPE html>
<html>
<head>
  <title>Jeffrey Bot</title>
    <link id="favicon" rel="icon" href="https://cdn.glitch.com/2c61ee42-4a04-4a21-b074-65934d0afc88%2FJBLogo.ico?1553650131111" type="image/x-icon">
<link rel="stylesheet" href="../css/main.css">
</head>  
<body>
  <script type="text/javascript" src="../presets.js"></script>
  <script>doHeader()</script>
        <div>

            <a href="#"><button class="grow">Top de usuarios por Jeffros</button></a>
            <br><br><br>
          
            <table>
              <thead>
                <tr>
                  <th>Place</th>
                  <th>User</th>
                  <th>Jeffros</th>
                </tr>
              </thead>
              <tbody id="tabla">
              </tbody>
            </table>
          
            <script type="text/javascript">
          
              const Discord = require("discord.js");
              const client = new Discord.Client();
              const mongoose = require("mongoose");
              mongoose.connect(`${process.env.MONGOCONNECT}`, {
                useNewUrlParser: true
              });


              const Jeffros = require("../modelos/jeffros.js");
              
              Jeffros.find({}, (err, docs) => {
                console.log(docs);
                docs.forEach((doc) => {
                  var usuario = client.users.get(doc.userID);
                  var tabla = document.getElementById("tabla");
                  
                  tabla.innerHTML = `<tr><<td>${usuario.tag}</td></</tr>`
                })
              })

              /*
              Jeffros.find({
                serverID: 447797737216278528
              }).sort([['jeffros', 'descending']
              ]).exec((err, res) => {
                  if(err) throw err;

                  document.write("<table><tr><th>Usuario</th><th>Jeffros</th></tr>");
                  // output data of each row
                  for(var i = 0; i < res.lenght; i++) {
                    let guildo = client.guilds.get("447797737216278528");
                    let member = guildo.members.get(res[i].userID) || "User left";
                    if(member === "User left"){
                      document.write("<tr><td>"+member+"</td><td>"+res[i].jeffros+"</td></tr>");
                    } else {
                      document.write("<tr><td>"+member.user.username+"</td><td>"+res[i].jeffros+"</td></tr>");
                    }
                  }
                  document.write("</table>");
                });*/
              
              client.login(process.env.TOKEN);
            </script>
        </div>

        <script>doFooter()</script>
</body>
</html>
